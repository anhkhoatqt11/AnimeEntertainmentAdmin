datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id              Int      @id @default(autoincrement())
  name            String
  email           String   @unique
  phoneNumber     String?
  password        String
  diaChi          String?
  role            String?  @default("user")
  avatar          String?  @default("https://i0.wp.com/www.repol.copl.ulaval.ca/wp-content/uploads/2019/01/default-user-icon.jpg?ssl=1")
  isEmailVerified Boolean  @default(false)
  createdAt       DateTime @default(now())
  SuKiens         SuKien[]
  HoaDon          HoaDon[]
}

model SuKien {
  id            Int      @id @default(autoincrement())
  name          String
  moTa          String?
  diaChi        String?
  hinhAnhSuKien String?  @db.LongText
  ngayBatDau    DateTime
  ngayKetThuc   DateTime
  userId        Int
  user          User     @relation(fields: [userId], references: [id])
  ChuDeId       Int
  ChuDe         ChuDe    @relation(fields: [ChuDeId], references: [id])
  ves           Ve[]

  @@index([userId])
  @@index([ChuDeId])
}

model ChuDe {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  SuKiens   SuKien[]
}

model Ve {
  id              Int        @id @default(autoincrement())
  name            String
  moTa            String?
  gia             Float
  mau             String
  soLuong         Int
  soLuongToiThieu Int
  soLuongToiDa    Int
  ngayBan         DateTime
  ngayKetThuc     DateTime
  SuKienId        Int
  suKien          SuKien     @relation(fields: [SuKienId], references: [id])
  HoaDon          HoaDon[]
  HoaDonVe        HoaDonVe[]

  @@index([SuKienId])
}

model HoaDon {
  id                  Int        @id @default(autoincrement())
  ngayDatHang         DateTime
  userId              Int
  user                User       @relation(fields: [userId], references: [id])
  phuongThucThanhToan String
  createdAt           DateTime   @default(now())
  HoaDonVe            HoaDonVe[]
  Ve                  Ve?        @relation(fields: [veId], references: [id])
  veId                Int?

  @@index([userId])
  @@index([veId])
}

model HoaDonVe {
  id       Int    @id @default(autoincrement())
  hoaDonId Int
  hoaDon   HoaDon @relation(fields: [hoaDonId], references: [id])
  veId     Int
  ve       Ve     @relation(fields: [veId], references: [id])
  soLuong  Int
  tongGia  Float

  @@index([hoaDonId, veId], name: "HoaDonVe_HoaDonVeId")
  @@index([veId])
}
